dependencies:
    pre:
        - sudo add-apt-repository -y ppa:ubuntugis/ubuntugis-unstable
        - sudo apt-get update -qq
        - sudo apt-get install -y libatlas3-base

        # Method 1, use system libs and assume binary compatibility
        # - sudo apt-get install -y libgdal1h

        # Method 2, use mostly system libs plus custom built debs
        - sudo apt-get install -y `apt-cache depends libgdal1h | awk '/Depends:/{print$2}'`
        - export INDEX_NAME=pxm
        - cd /tmp
        - wget https://dd8kvqd1c0bor.cloudfront.net/${INDEX_NAME}/debs.tar.gz
        - tar -xzvf debs.tar.gz
        - for deb in *.deb; do sudo dpkg -i $deb; done
        - sudo ldconfig

        - sudo update-alternatives --set libblas.so.3 /usr/lib/atlas-base/atlas/libblas.so.3
        - sudo update-alternatives --set liblapack.so.3 /usr/lib/atlas-base/atlas/liblapack.so.3
    override:
        - pip install -U pip
        - pip install --extra-index-url=https://dd8kvqd1c0bor.cloudfront.net/pxm/simple -c https://dd8kvqd1c0bor.cloudfront.net/pxm/constraints.txt -r requirements.txt
        - pip install -e ".[test]"

test:
    override:
        - py.test --cov supermercado --cov-report term-missing --ignore=venv
    post:
        - codecov -t edd1a7e8-82bf-4377-ad81-67fc3f104b72
        - codecov

